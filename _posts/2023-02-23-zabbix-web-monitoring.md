---
published: true
---
# Шаг 1: Генерация простого веб-сценария Zabbix через шаблон

Веб-сценарий — это ключевой механизм, позволяющий осуществлять веб-мониторинг в Zabbix. Веб-сценарий состоит из одного или нескольких шагов (HTTP-запросов), которые периодически выполняются в заранее определенном порядке.

Можно создавать веб-скрипты прямо на хосте, но это не лучшая практика. Веб-сценарии лучше создавать в шаблоне, а затем привязывать их к хосту.

## 1.1) Создать шаблон Zabbix для мониторинга веб-сайта

Перейдите к «Настройка» в разделе «Шаблоны» нажмите кнопку «Создать шаблон». На вкладке «Шаблон» вам необходимо определить «Имя шаблона» и группу хостов — «Группы».
![z6_img2_1.png]({{site.baseurl}}/static/images/z6_img2_1.png)

Затем во вкладке «Макросы» и создайте макрос {$WEB.URL}, но пока оставьте поле значения пустым. Вы зададите URL-адрес в этом поле позже, когда свяжете шаблон с хостом.
![z6_img2_2.png]({{site.baseurl}}/static/images/z6_img2_2.png)

```
ПРИМЕЧАНИЕ. Позже вы установите URL-адрес веб-сайта, который хотите отслеживать, в макросе {$WEB.URL}.
И везде, где этот макрос используется в шаблоне, он будет переведен в этот URL-адрес. Таким образом,
вы можете использовать один шаблон на нескольких хостах и ​​отслеживать разные веб-сайты, не меняя шаблон.
```
Нажмите кнопку «Добавить», чтобы создать шаблон и перейти к следующему шагу.

## 1.2) Создайте веб-сценарий в шаблоне

Теперь перейдите к только что созданному шаблону и нажмите кнопку «Создать веб-сценарий» на вкладке «Веб-сценарии». Установите имя «Проверка работоспособности веб-сайта: {$WEB.URL}» и выберите агент браузера по вашему выбору в раскрывающемся списке «Агент».
![z6_img2_3.png]({{site.baseurl}}/static/images/z6_img2_3.png)

После этого перейдите на вкладку «Шаги» и нажмите маленькую кнопку «Добавить», чтобы создать свой первый шаг. Появится новое окно, в котором вам нужно установить «Имя» на «Доступность веб-сайта», «URL» на «{$WEB.URL}», включить «Отслеживать перенаправления» и «Требуемые коды состояния» на «200». По сути, мы говорим Zabbix, что он должен получить код 200, если страница работает правильно.
![z6_img2_4.png]({{site.baseurl}}/static/images/z6_img2_4.png)

Теперь нажмите большую кнопку «Добавить», чтобы создать шаг. И после того, как окно закроется, нажмите вторую кнопку «Добавить»

Вы создали свой первый веб-сценарий!

Обратите внимание, что вы можете ввести дополнительные обязательные коды состояния (через запятую), которые будут указывать на то, что страница работает правильно. В дополнение к коду состояния 200 можно добавлять коды 401, 403, 410 и 503. Узнайте больше о кодах состояния в [IANA](https://www.iana.org/assignments/http-status-codes/http-status-codes.xhtml) или [Википедии](https://en.wikipedia.org/wiki/List_of_HTTP_status_codes).

| Коды состояния HTTP | Описание |
| ------ | ------ |
| 200 | OK — стандартный ответ на успешные HTTP-запросы |
| 401 | Неавторизованный — у пользователя нет действительных учетных данных для аутентификации целевого ресурса. |
| 403 | Запрещено — запрос содержит допустимые данные, но не имеет необходимых разрешений для ресурса. 
| 410 | Исчез — указывает, что запрошенный ресурс больше недоступен и больше не будет доступен (удален администратором). |
| 503 | Служба недоступна — обычно этот код используется для обозначения того, что веб-сайт закрыт на техническое обслуживание. |

## 1.3) Создайте триггер (будильник) для веб-сценария

Если вы хотите получать уведомления, когда ваш сайт недоступен или тормозит, вам необходимо создать триггеры Zabbix. Для этого вам необходимо обновить наш шаблон мониторинга веб-сайтов, добавив новый триггер.
![z6_img2_5.png]({{site.baseurl}}/static/images/z6_img2_5.png)

Во-первых, мы создадим триггер, который будет проверять доступность сайта каждую минуту. Перейдите в «Конфигурация» → «Шаблоны» → найдите и щелкните шаблон «Мониторинг веб-сайта» → выберите вкладку «Триггеры» → нажмите кнопку «Создать триггер».

Установите имя триггера на:

`Веб-сайт недоступен: "{$WEB.URL}"`

Серьезность может быть какой угодно. Добавьте триггерное выражение, используя это маленькое «Добавить» или вручную в виде текста, используя это выражение:

```
New syntax expression (Zabbix 5.4 and later)
last(/Website monitoring/web.test.fail[Website Health Check: {$WEB.URL}])<>0
Old syntax expression (Zabbix 5.2 and older)
{Website monitoring:web.test.fail[Website Health Check: {$WEB.URL}].last()}<>0
```

Обратите внимание, что вы можете заменить функцию «last()» на функцию «max(5m)», если хотите получать уведомления только тогда, когда веб-сайт не работает более 5 минут. Аварийные сигналы иногда могут быть спамом при использовании «last» функции, поэтому рассмотрите возможность использования функций «avg», «max» или «min» ([hysteresis](https://www.zabbix.com/documentation/current/manual/config/triggers/expression#hysteresis)).

Нажмите эту большую кнопку «Добавить», когда вы закончите настройку триггера, и все готово!

Предыдущий триггер предупредит вас, если наш веб-сайт недоступен, но что, если он доступен, но очень-очень медленно? Нам нужен еще один триггер, который предупредит нас о такой проблеме. Давайте создадим этот триггер! Просто повторите ту же процедуру: перейдите в «Конфигурация» → «Шаблоны» → Найдите и щелкните шаблон «Мониторинг веб-сайта» → Выберите вкладку «Триггеры» → Нажмите кнопку «Создать триггер».
![z6_img2_6.png]({{site.baseurl}}/static/images/z6_img2_6.png)

Установите имя триггера на:

`Website is SLOW ({ITEM.LASTVALUE}): {$WEB.URL}`

Серьезность может быть какой угодно. Добавьте триггерное выражение, используя это маленькое «Добавить» или вручную в виде текста, используя это выражение:

```
New syntax expression (Zabbix 5.4 and later)
avg(/Website monitoring/web.test.time[Website Health Check: {$WEB.URL},Webpage Availability,resp],10m)>8
Old syntax expression (Zabbix 5.2 and older)
{Website monitoring:web.test.time[Website Health Check: {$WEB.URL},Webpage Availability,resp].avg(10m)}>8
```

Нажмите эту большую кнопку «Добавить», когда вы закончите настройку триггера, и все!

```
!ПРИМЕЧАНИЕ. Рассмотрите возможность создания нового макроса {$URL.SPEED} в шаблоне и замены 8 секунд на
{$URL.SPEED} в выражении триггера. Это будет полезно, если вы планируете часто менять этот порог или
 если у вас есть несколько сайтов с совершенно разным временем отклика.
```

### Вы создали простой веб-сценарий в Zabbix, используя шаблон! Теперь вам нужно включить мониторинг веб-сайта, связав этот шаблон с хостом и определив URL-адрес в макросе!

# Шаг 2: Включить мониторинг веб-сайта на хосте в Zabbix

В меню «Хост» в разделе «Конфигурация», а затем нажмите «Создать хост», чтобы создать хост в Zabbix. Установите «Имя хоста», установите что-то, что будет описывать то, что вы отслеживаете. Создайте свою группу с помощью поля «Группы» или используйте существующую.
![z6_img2_7.png]({{site.baseurl}}/static/images/z6_img2_7.png)

Пока не нажимайте кнопку «Добавить»! Нам нужно связать шаблон, который мы создали на предыдущем шаге, и настроить макрос {$WEB.URL}. Перейдите на вкладку «Шаблоны» и свяжите шаблон «Мониторинг веб-сайта» с помощью поля «Связать новые шаблоны».
![z6_img2_8.png]({{site.baseurl}}/static/images/z6_img2_8.png)

Перейдите на вкладку «Макросы», нажмите «Изменить» для макроса «{$WEB.URL}» и укажите URL-адрес веб-сайта, который необходимо отслеживать, в поле значения этого макроса.
![z6_img2_9.png]({{site.baseurl}}/static/images/z6_img2_9.png)

# Шаг 3: Графики веб-мониторинга

There are several ways to visualize data on Zabbix, but to simplify things, let’s see the default visualization for web scenarios. Navigate to “Monitoring”→ “Hosts”→ Search your host→ Click on the “Web” button→ and then click on your web scenario to view graphs.
![z6_img2_10.png]({{site.baseurl}}/static/images/z6_img2_10.png)
